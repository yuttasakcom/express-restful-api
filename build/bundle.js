!function(e){function t(u){if(n[u])return n[u].exports;var r=n[u]={i:u,l:!1,exports:{}};return e[u].call(r.exports,r,r.exports,t),r.l=!0,r.exports}var n={};t.m=e,t.c=n,t.d=function(e,n,u){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:u})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=6)}([function(e,t){e.exports=require("mongoose")},function(e,t){e.exports=require("passport")},function(e,t){e.exports=require("express")},function(e,t){e.exports=require("crypto")},function(e,t,n){"use strict";function u(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),o=u(r),s=n(3),i=u(s),d=new o.default.Schema({username:{type:String,unique:!0,required:!0},hashedPassword:{type:String,required:!0},salt:{type:String,required:!0},created_at:{type:Date,default:Date.now}});d.methods.encryptPassword=function(e){return i.default.pbkdf2Sync(e,(void 0).salt,1e4,512,"sha512").toString("hex")},d.virtual("userId").get(function(){return(void 0).id}),d.virtual("password").set(function(e){(void 0)._plainPassword=e,(void 0).salt=i.default.randomBytes(128).toString("hex"),(void 0).hashedPassword=(void 0).encryptPassword(e)}).get(function(){return(void 0)._plainPassword}),d.methods.checkPassword=function(e){return(void 0).encryptPassword(e)===(void 0).hashedPassword},t.default=o.default.model("users",d)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var u=n(0),r=function(e){return e&&e.__esModule?e:{default:e}}(u),o=new r.default.Schema({userId:{type:String,required:!0},clientId:{type:String,required:!0},token:{type:String,unique:!0,required:!0},created_at:{type:Date,default:Date.now}});t.default=r.default.model("access_tokens",o)},function(e,t,n){"use strict";function u(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var r=n(7),o=u(r),s=n(8),i=u(s),d=o.default.createServer(i.default);d.listen(i.default.get("port"),i.default.get("host"),function(){console.log("Server is running on http://"+i.default.get("host")+":"+i.default.get("port")),console.log("Press CTRL-C to stop")}),t.default=d},function(e,t){e.exports=require("http")},function(e,t,n){"use strict";function u(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=u(r),s=n(9),i=u(s),d=n(10),a=u(d),l=n(11),f=u(l),c=n(12),p=u(c),_=n(13),v=u(_),y=n(1),g=u(y),m=n(14),S=u(m),h=n(15),O=u(h),x=n(17),M=u(x);n(23),n(24),p.default.config({path:"../.env"});var q=(0,o.default)();q.enable("trust proxy"),q.disable("x-powered-by"),q.set("trust proxy",1),q.set("host",process.env.HOST||"127.0.0.1"),q.set("port",process.env.PORT||"3000"),q.use((0,i.default)()),q.use(O.default),q.use((0,f.default)()),q.use((0,a.default)("common")),q.use((0,S.default)({name:"session",keys:[process.env.COOKIE_SESSION_SECRET_KEY1,process.env.COOKIE_SESSION_SECRET_KEY2],maxAge:process.env.COOKIE_SESSION_MAX_AGE})),q.use(v.default.json({extended:!1})),q.use(v.default.urlencoded({extended:!1})),q.use(g.default.initialize()),q.use(g.default.session()),(0,M.default)(q),t.default=q},function(e,t){e.exports=require("helmet")},function(e,t){e.exports=require("morgan")},function(e,t){e.exports=require("compression")},function(e,t){e.exports=require("dotenv")},function(e,t){e.exports=require("body-parser")},function(e,t){e.exports=require("cookie-session")},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var u=n(16),r=function(e){return e&&e.__esModule?e:{default:e}}(u),o={windowMs:9e5,max:100,delayMs:0};t.default=new r.default(o)},function(e,t){e.exports=require("express-rate-limit")},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var u=n(18),r=function(e){return e&&e.__esModule?e:{default:e}}(u);t.default=function(e){e.get("/login",function(e,t){t.json({msg:"login"})}),e.use("/api",r.default),e.use(function(e,t,n){t.status(404),t.json({error:"Not found"})}),e.use(function(e,t,n,u){n.status(e.status||500),n.json({error:e.message})})}},function(e,t,n){"use strict";function u(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(19),s=u(o),i=n(22),d=u(i),a=(0,r.Router)();a.post("/oauth/token",s.default.token),a.get("/user/me",d.default.info),a.get("/",function(e,t){t.end("express restful api")}),t.default=a},function(e,t,n){"use strict";function u(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var r=n(20),o=u(r),s=n(1),i=u(s),d=n(3),a=u(d),l=n(4),f=u(l),c=n(5),p=u(c),_=n(21),v=u(_),y=o.default.createServer(),g=function(e,t){if(t)return e(t)},m=function(e,t){var n=g.bind(void 0,t),u=void 0,r=void 0,o=void 0,s=void 0;v.default.remove(e,n),p.default.remove(e,n),s=a.default.randomBytes(32).toString("hex"),r=a.default.randomBytes(32).toString("hex"),e.token=s,o=new p.default(e),e.token=r,u=new v.default(e),u.save(n),o.save(function(e){if(e)return t(e);t(null,s,r,{expires_in:process.env.TOKEN_MAX_AGE})})};y.exchange(o.default.exchange.password(function(e,t,n,u,r){f.default.findOne({username:t},function(t,u){if(t)return r(t);if(!u||!u.checkPassword(n))return r(null,!1);var o={userId:u.userId,clientId:e.clientId};m(o,r)})}));var S=[i.default.authenticate(["oauth2-client-password"],{session:!1}),y.token(),y.errorHandler()];t.default={token:S}},function(e,t){e.exports=require("oauth2orize")},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var u=n(0),r=function(e){return e&&e.__esModule?e:{default:e}}(u),o=new r.default.Schema({userId:{type:String,required:!0},clientId:{type:String,required:!0},token:{type:String,unique:!0,required:!0},created:{type:Date,default:Date.now}});t.default=r.default.model("refresh_tokens",o)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var u=n(1),r=function(e){return e&&e.__esModule?e:{default:e}}(u),o=[r.default.authenticate("bearer",{session:!1}),function(e,t){t.json({id:e.user.id,name:e.user.name,scope:e.authInfo.scope})}];t.default={info:o}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var u=n(0),r=function(e){return e&&e.__esModule?e:{default:e}}(u);r.default.Promise=global.Promise;var o=process.env.MONGODB_HOST||"localhost",s=process.env.MONGODB_PORT||"27017",i=process.env.MONGODB_DB_NAME||"apis";r.default.connect("mongodb://"+o+":"+s+"/"+i),t.default=r.default},function(e,t,n){"use strict";function u(e){return e&&e.__esModule?e:{default:e}}var r=n(1),o=u(r),s=n(25),i=n(26),d=n(4),a=u(d),l=n(5),f=u(l),c=n(27),p=u(c);o.default.use(new s.Strategy(function(e,t,n){p.default.findOne({clientId:e},function(e,u){return e?n(e):u?u.clientSecret!==t?n(null,!1):n(null,u):n(null,!1)})})),o.default.use(new i.Strategy(function(e,t){f.default.findOne({token:e},function(n,u){return n?t(n):u?Math.round((Date.now()-u.created)/1e3)>process.env.TOKEN_MAX_AGE?(f.default.remove({token:e},function(e){if(e)return t(e)}),t(null,!1,{message:"Token expired"})):void a.default.findById(u.userId,function(e,n){return e?t(e):n?void t(null,n,{scope:"*"}):t(null,!1,{message:"Unknown user"})}):t(null,!1)})}))},function(e,t){e.exports=require("passport-oauth2-client-password")},function(e,t){e.exports=require("passport-http-bearer")},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var u=n(0),r=function(e){return e&&e.__esModule?e:{default:e}}(u),o=new r.default.Schema({name:{type:String,unique:!0,required:!0},clientId:{type:String,unique:!0,required:!0},clientSecret:{type:String,required:!0}});t.default=r.default.model("clients",o)}]);