!function(e){function n(r){if(t[r])return t[r].exports;var u=t[r]={i:r,l:!1,exports:{}};return e[r].call(u.exports,u,u.exports,n),u.l=!0,u.exports}var t={};n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:r})},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)},n.p="",n(n.s=5)}([function(e,n){e.exports=require("passport")},function(e,n){e.exports=require("express")},function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=[{id:"1",username:"bob",password:"secret",name:"Bob Smith"},{id:"2",username:"joe",password:"password",name:"Joe Davis"}],u=function(e,n){for(var t=0,u=r.length;t<u;t++)if(r[t].id===e)return n(null,r[t]);return n(new Error("User Not Found"))},i=function(e,n){for(var t=0,u=r.length;t<u;t++)if(r[t].username===e)return n(null,r[t]);return n(new Error("User Not Found"))};n.default={findById:u,findByUsername:i}},function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r={},u=function(e,n){return r[e]?n(null,r[e]):n(new Error("Token Not Found"))},i=function(e,n,t){for(var u in r)if(r[u].userId===e&&r[u].clientId===n)return t(null,u);return t(new Error("Token Not Found"),null)},o=function(e,n,t,u){r[e]={userId:n,clientId:t},u()};n.default={find:u,findByUserIdAndClientId:i,save:o}},function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=[{id:"1",name:"Samplr",clientId:"abc123",clientSecret:"ssh-secret",isTrusted:!1},{id:"2",name:"Samplr2",clientId:"xyz123",clientSecret:"ssh-password",isTrusted:!0}],u=function(e,n){for(var t=0,u=r.length;t<u;t++)if(r[t].id===e)return n(null,r[t]);return n(new Error("Client Not Found"))},i=function(e,n){for(var t=0,u=r.length;t<u;t++)if(r[t].clientId===e)return n(null,r[t]);return n(new Error("Client Not Found"))};n.default={findById:u,findByClientId:i}},function(e,n,t){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(n,"__esModule",{value:!0});var u=t(6),i=r(u),o=t(7),l=r(o),d=i.default.createServer(l.default);d.listen(l.default.get("port"),l.default.get("host"),function(){console.log("Server is running on http://"+l.default.get("host")+":"+l.default.get("port")),console.log("Press CTRL-C to stop")}),n.default=d},function(e,n){e.exports=require("http")},function(e,n,t){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(n,"__esModule",{value:!0});var u=t(1),i=r(u),o=t(8),l=r(o),d=t(9),f=r(d),a=t(10),s=r(a),c=t(11),p=r(c),v=t(12),g=r(v),_=t(13),y=r(_),I=t(0),x=r(I),h=t(14),m=r(h);t(15);var M=t(17),b=r(M),O=t(19),w=r(O);t(26),p.default.config({path:"../.env"});var B=(0,i.default)();B.enable("trust proxy"),B.disable("x-powered-by"),B.set("host",process.env.HOST||"127.0.0.1"),B.set("port",process.env.PORT||"3000"),B.use((0,l.default)()),B.use(b.default),B.use((0,s.default)()),B.use((0,f.default)("common")),B.use((0,m.default)({name:"session",keys:["key1","key2"],maxAge:36e3})),B.use(g.default.json({extended:!1})),B.use(g.default.urlencoded({extended:!1})),B.use((0,y.default)()),B.use(x.default.initialize()),B.use(x.default.session()),(0,w.default)(B),n.default=B},function(e,n){e.exports=require("helmet")},function(e,n){e.exports=require("morgan")},function(e,n){e.exports=require("compression")},function(e,n){e.exports=require("dotenv")},function(e,n){e.exports=require("body-parser")},function(e,n){e.exports=require("errorhandler")},function(e,n){e.exports=require("cookie-session")},function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=t(16);r.Promise=global.Promise;var u=process.env.MONGODB_HOST||"localhost",i=process.env.MONGODB_PORT||"27017",o=process.env.MONGODB_DB_NAME||"apis";r.connect("mongodb://"+u+":"+i+"/"+o),n.default=r},function(e,n){e.exports=require("mongoose")},function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=t(18),u=function(e){return e&&e.__esModule?e:{default:e}}(r),i={windowMs:9e5,max:100,delayMs:0};n.default=new u.default(i)},function(e,n){e.exports=require("express-rate-limit")},function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=t(20),u=function(e){return e&&e.__esModule?e:{default:e}}(r);n.default=function(e){e.use("/api",u.default)}},function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=t(1),u=t(21),i=function(e){return e&&e.__esModule?e:{default:e}}(u),o=(0,r.Router)();o.post("/oauth/token",i.default.token),o.get("/",function(e,n){n.end("Api")}),n.default=o},function(e,n,t){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(n,"__esModule",{value:!0});var u=t(22),i=r(u),o=t(0),l=r(o),d=t(23),f=r(d),a=t(24),s=r(a),c=t(2),p=r(c),v=t(3),g=r(v),_=t(25),y=r(_),I=t(4),x=r(I),h=i.default.createServer();h.serializeClient(function(e,n){return n(null,e.id)}),h.deserializeClient(function(e,n){x.default.findById(e,function(e,t){return e?n(e):n(null,t)})}),h.grant(i.default.grant.code(function(e,n,t,r,u){var i=s.default.getUid(16);y.default.save(i,e.id,n,t.id,function(e){return e?u(e):u(null,i)})})),h.grant(i.default.grant.token(function(e,n,t,r){var u=s.default.getUid(256);g.default.save(u,n.id,e.clientId,function(e){return e?r(e):r(null,u)})})),h.exchange(i.default.exchange.code(function(e,n,t,r){y.default.find(n,function(n,u){if(n)return r(n);if(e.id!==u.clientId)return r(null,!1);if(t!==u.redirectUri)return r(null,!1);var i=s.default.getUid(256);g.default.save(i,u.userId,u.clientId,function(e){return e?r(e):r(null,i)})})})),h.exchange(i.default.exchange.password(function(e,n,t,r,u){x.default.findByClientId(e.clientId,function(r,i){return r?u(r):i?i.clientSecret!==e.clientSecret?u(null,!1):void p.default.findByUsername(n,function(n,r){if(n)return u(n);if(!r)return u(null,!1);if(t!==r.password)return u(null,!1);var i=s.default.getUid(256);g.default.save(i,r.id,e.clientId,function(e){return e?u(e):u(null,i)})}):u(null,!1)})})),h.exchange(i.default.exchange.clientCredentials(function(e,n,t){x.default.findByClientId(e.clientId,function(n,r){if(n)return t(n);if(!r)return t(null,!1);if(r.clientSecret!==e.clientSecret)return t(null,!1);var u=s.default.getUid(256);g.default.save(u,null,e.clientId,function(e){return e?t(e):t(null,u)})})}));var m=[f.default.ensureLoggedIn(),h.authorization(function(e,n,t){x.default.findByClientId(e,function(e,r){return e?t(e):t(null,r,n)})},function(e,n,t){if(e.isTrusted)return t(null,!0);g.default.findByUserIdAndClientId(n.id,e.clientId,function(e,n){return n?t(null,!0):t(null,!1)})}),function(e,n){n.render("dialog",{transactionId:e.oauth2.transactionID,user:e.user,client:e.oauth2.client})}],M=[f.default.ensureLoggedIn(),h.decision()],b=[l.default.authenticate(["oauth2-client-password"],{session:!1}),h.token(),h.errorHandler()];n.default={authorization:m,decision:M,token:b}},function(e,n){e.exports=require("oauth2orize")},function(e,n){e.exports=require("connect-ensure-login")},function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(e){for(var n="",t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",r=t.length,i=0;i<e;++i)n+=t[u(0,r-1)];return n},u=function(e,n){return Math.floor(Math.random()*(n-e+1))+e};n.default={getUid:r,getRandomInt:u}},function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r={},u=function(e,n){return r[e]?n(null,r[e]):n(new Error("Code Not Found"))},i=function(e,n,t,u,i){r[e]={clientId:n,redirectUri:t,userId:u},i()};n.default={find:u,save:i}},function(e,n,t){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}var u=t(0),i=r(u),o=t(27),l=t(28),d=t(29),f=t(2),a=r(f),s=t(3),c=r(s),p=t(4),v=r(p);i.default.use(new o.Strategy(function(e,n,t){a.default.findByUsername(e,function(e,r){return e?t(e):r?r.password!==n?t(null,!1):t(null,r):t(null,!1)})})),i.default.serializeUser(function(e,n){return n(null,e.id)}),i.default.deserializeUser(function(e,n){a.default.findById(e,function(e,t){return n(e,t)})});var g=function(e,n,t){v.default.findByClientId(e,function(e,r){return e?t(e):r?r.clientSecret!==n?t(null,!1):t(null,r):t(null,!1)})};i.default.use(new l.Strategy(g)),i.default.use(new d.Strategy(function(e,n){c.default.find(e,function(e,t){return e?n(e):t?void(t.userId?a.default.findById(t.userId,function(e,t){return e?n(e):t?void n(null,t,{scope:"*"}):n(null,!1)}):v.default.findByClientId(t.clientId,function(e,t){return e?n(e):t?void n(null,t,{scope:"*"}):n(null,!1)})):n(null,!1)})}))},function(e,n){e.exports=require("passport-local")},function(e,n){e.exports=require("passport-oauth2-client-password")},function(e,n){e.exports=require("passport-http-bearer")}]);