!function(e){function t(u){if(n[u])return n[u].exports;var r=n[u]={i:u,l:!1,exports:{}};return e[u].call(r.exports,r,r.exports,t),r.l=!0,r.exports}var n={};t.m=e,t.c=n,t.d=function(e,n,u){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:u})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=5)}([function(e,t){e.exports=require("mongoose")},function(e,t){e.exports=require("passport")},function(e,t){e.exports=require("express")},function(e,t,n){"use strict";function u(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),o=u(r),s=n(22),a=u(s),i=new o.default.Schema({email:{type:String,unique:!0,required:!0},password:{type:String,required:!0},created_at:{type:Date,default:Date.now}});i.methods.generateHash=function(e){return a.default.hashSync(e,a.default.genSaltSync(8),null)},i.methods.validPassword=function(e){return a.default.compareSync(e,(void 0).password)},t.default=o.default.model("users",i)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var u=n(0),r=function(e){return e&&e.__esModule?e:{default:e}}(u),o=new r.default.Schema({userId:{type:String,required:!0},clientId:{type:String,required:!0},token:{type:String,unique:!0,required:!0},created_at:{type:Date,default:Date.now}});t.default=r.default.model("access_tokens",o)},function(e,t,n){"use strict";function u(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var r=n(6),o=u(r),s=n(7),a=u(s),i=o.default.createServer(a.default);i.listen(a.default.get("port"),a.default.get("host"),function(){console.log("Server is running on http://"+a.default.get("host")+":"+a.default.get("port")),console.log("Press CTRL-C to stop")}),t.default=i},function(e,t){e.exports=require("http")},function(e,t,n){"use strict";function u(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),n(8);var r=n(2),o=u(r),s=n(9),a=u(s),i=n(10),l=u(i),d=n(11),f=u(d),c=n(12),p=u(c),_=n(13),v=u(_),g=n(1),m=u(g),y=n(14),S=u(y),O=n(15),x=u(O),h=n(17),M=u(h);n(25),n(26),p.default.config({path:"../.env"});var q=(0,o.default)();q.enable("trust proxy"),q.disable("x-powered-by"),q.set("trust proxy",1),q.set("host",process.env.HOST||"127.0.0.1"),q.set("port",process.env.PORT||"3000"),q.use((0,a.default)()),q.use(x.default),q.use((0,f.default)()),q.use((0,l.default)("common")),q.use((0,S.default)({name:"session",keys:[process.env.COOKIE_SESSION_SECRET_KEY1,process.env.COOKIE_SESSION_SECRET_KEY2],maxAge:process.env.COOKIE_SESSION_MAX_AGE})),q.use(v.default.json({extended:!1})),q.use(v.default.urlencoded({extended:!1})),q.use(m.default.initialize()),q.use(m.default.session()),(0,M.default)(q),t.default=q},function(e,t){e.exports=require("babel-polyfill")},function(e,t){e.exports=require("helmet")},function(e,t){e.exports=require("morgan")},function(e,t){e.exports=require("compression")},function(e,t){e.exports=require("dotenv")},function(e,t){e.exports=require("body-parser")},function(e,t){e.exports=require("cookie-session")},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var u=n(16),r=function(e){return e&&e.__esModule?e:{default:e}}(u),o={windowMs:9e5,max:100,delayMs:0};t.default=new r.default(o)},function(e,t){e.exports=require("express-rate-limit")},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var u=n(18),r=function(e){return e&&e.__esModule?e:{default:e}}(u);t.default=function(e){e.get("/login",function(e,t){t.json({msg:"login"})}),e.use("/api",r.default),e.use(function(e,t,n){t.status(404),t.json({error:"Not found"})}),e.use(function(e,t,n,u){n.status(e.status||500),n.json({error:e.message})})}},function(e,t,n){"use strict";function u(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(19),s=u(o),a=n(24),i=u(a),l=(0,r.Router)();l.post("/oauth/token",s.default.token),l.post("/user/signup",i.default.signup,function(e,t){return t.json(e.user)}),l.get("/user/me",i.default.me),l.get("/",function(e,t){t.end("express restful api")}),t.default=l},function(e,t,n){"use strict";function u(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var r=n(20),o=u(r),s=n(1),a=u(s),i=n(21),l=u(i),d=n(3),f=u(d),c=n(4),p=u(c),_=n(23),v=u(_),g=o.default.createServer(),m=function(e,t){if(t)return e(t)},y=function(e,t){var n=m.bind(void 0,t),u=void 0,r=void 0,o=void 0,s=void 0;v.default.remove(e,n),p.default.remove(e,n),s=l.default.randomBytes(32).toString("hex"),r=l.default.randomBytes(32).toString("hex"),e.token=s,o=new p.default(e),e.token=r,u=new v.default(e),u.save(n),o.save(function(e){if(e)return t(e);t(null,s,r,{expires_in:process.env.TOKEN_MAX_AGE})})};g.exchange(o.default.exchange.password(function(e,t,n,u,r){f.default.findOne({username:t},function(t,u){if(t)return r(t);if(!u||!u.checkPassword(n))return r(null,!1);var o={userId:u.userId,clientId:e.clientId};y(o,r)})}));var S=[a.default.authenticate(["oauth2-client-password"],{session:!1}),g.token(),g.errorHandler()];t.default={token:S}},function(e,t){e.exports=require("oauth2orize")},function(e,t){e.exports=require("crypto")},function(e,t){e.exports=require("bcrypt-nodejs")},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var u=n(0),r=function(e){return e&&e.__esModule?e:{default:e}}(u),o=new r.default.Schema({userId:{type:String,required:!0},clientId:{type:String,required:!0},token:{type:String,unique:!0,required:!0},created:{type:Date,default:Date.now}});t.default=r.default.model("refresh_tokens",o)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var u=n(1),r=function(e){return e&&e.__esModule?e:{default:e}}(u),o=[r.default.authenticate("bearer",{session:!1}),function(e,t){t.json({id:e.user.id,name:e.user.name,scope:e.authInfo.scope})}],s=r.default.authenticate("local-signup");t.default={me:o,signup:s}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var u=n(0),r=function(e){return e&&e.__esModule?e:{default:e}}(u);r.default.Promise=global.Promise;var o=process.env.MONGODB_HOST||"localhost",s=process.env.MONGODB_PORT||"27017",a=process.env.MONGODB_DB_NAME||"apis";r.default.connect("mongodb://"+o+":"+s+"/"+a),t.default=r.default},function(e,t,n){"use strict";function u(e){return e&&e.__esModule?e:{default:e}}var r=n(1),o=u(r),s=n(27),a=n(28),i=n(29),l=n(3),d=u(l),f=n(4),c=u(f),p=n(30),_=u(p);o.default.serializeUser(function(e,t){return t(null,e.id)}),o.default.deserializeUser(function(e,t){return d.default.findById(e).then(function(e){return t(null,e)})}),o.default.use("local-signup",new s.Strategy({usernameField:"email",passwordField:"password",passReqToCallback:!0,session:!1},function(e,t,n,u){d.default.findOne({email:t},function(e,r){if(e)return u(e);if(r)return u({status:422,message:"That email is already taken."});var o=new d.default;o.email=t,o.password=o.generateHash(n),o.save(function(e){return e?u(e):u(null,o)})})})),o.default.use(new a.Strategy(function(e,t,n){_.default.findOne({clientId:e},function(e,u){return e?n(e):u?u.clientSecret!==t?n(null,!1):n(null,u):n(null,!1)})})),o.default.use(new i.Strategy(function(e,t){c.default.findOne({token:e},function(n,u){return n?t(n):u?Math.round((Date.now()-u.created)/1e3)>process.env.TOKEN_MAX_AGE?(c.default.remove({token:e},function(e){if(e)return t(e)}),t(null,!1,{message:"Token expired"})):void d.default.findById(u.userId,function(e,n){return e?t(e):n?void t(null,n,{scope:"*"}):t(null,!1,{message:"Unknown user"})}):t(null,!1)})}))},function(e,t){e.exports=require("passport-local")},function(e,t){e.exports=require("passport-oauth2-client-password")},function(e,t){e.exports=require("passport-http-bearer")},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var u=n(0),r=function(e){return e&&e.__esModule?e:{default:e}}(u),o=new r.default.Schema({name:{type:String,unique:!0,required:!0},clientId:{type:String,unique:!0,required:!0},clientSecret:{type:String,required:!0}});t.default=r.default.model("clients",o)}]);