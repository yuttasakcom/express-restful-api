!function(e){function n(u){if(t[u])return t[u].exports;var r=t[u]={i:u,l:!1,exports:{}};return e[u].call(r.exports,r,r.exports,n),r.l=!0,r.exports}var t={};n.m=e,n.c=t,n.d=function(e,t,u){n.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:u})},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)},n.p="",n(n.s=5)}([function(e,n){e.exports=require("passport")},function(e,n){e.exports=require("express")},function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var u=[{id:"1",username:"bob",password:"secret",name:"Bob Smith"},{id:"2",username:"joe",password:"password",name:"Joe Davis"}],r=function(e,n){for(var t=0,r=u.length;t<r;t++)if(u[t].id===e)return n(null,u[t]);return n(new Error("User Not Found"))},o=function(e,n){for(var t=0,r=u.length;t<r;t++)if(u[t].username===e)return n(null,u[t]);return n(new Error("User Not Found"))};n.default={findById:r,findByUsername:o}},function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var u={},r=function(e,n){return u[e]?n(null,u[e]):n(new Error("Token Not Found"))},o=function(e,n,t){for(var r in u)if(u[r].userId===e&&u[r].clientId===n)return t(null,r);return t(new Error("Token Not Found"),null)},i=function(e,n,t,r){u[e]={userId:n,clientId:t},r()};n.default={find:r,findByUserIdAndClientId:o,save:i}},function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var u=[{id:"1",name:"Samplr",clientId:"abc123",clientSecret:"ssh-secret",isTrusted:!1},{id:"2",name:"Samplr2",clientId:"xyz123",clientSecret:"ssh-password",isTrusted:!0}],r=function(e,n){for(var t=0,r=u.length;t<r;t++)if(u[t].id===e)return n(null,u[t]);return n(new Error("Client Not Found"))},o=function(e,n){for(var t=0,r=u.length;t<r;t++)if(u[t].clientId===e)return n(null,u[t]);return n(new Error("Client Not Found"))};n.default={findById:r,findByClientId:o}},function(e,n,t){"use strict";function u(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(n,"__esModule",{value:!0});var r=t(6),o=u(r),i=t(7),l=u(i),d=o.default.createServer(l.default);d.listen(l.default.get("port"),l.default.get("host"),function(){console.log("Server is running on http://"+l.default.get("host")+":"+l.default.get("port")),console.log("Press CTRL-C to stop")}),n.default=d},function(e,n){e.exports=require("http")},function(e,n,t){"use strict";function u(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(n,"__esModule",{value:!0});var r=t(1),o=u(r),i=t(8),l=u(i),d=t(9),s=u(d),f=t(10),a=u(f),c=t(11),p=u(c),v=t(12),_=u(v),g=t(0),I=u(g),y=t(13),x=u(y);t(14);var h=t(16),O=u(h),m=t(18),M=u(m);t(26),p.default.config({path:"../.env"});var b=(0,o.default)();b.enable("trust proxy"),b.disable("x-powered-by"),b.set("trust proxy",1),b.set("host",process.env.HOST||"127.0.0.1"),b.set("port",process.env.PORT||"3000"),b.use((0,l.default)()),b.use(O.default),b.use((0,a.default)()),b.use((0,s.default)("common")),b.use((0,x.default)({name:"session",keys:[process.env.COOKIE_SESSION_SECRET_KEY1,process.env.COOKIE_SESSION_SECRET_KEY2],maxAge:process.env.COOKIE_SESSION_MAX_AGE})),b.use(_.default.json({extended:!1})),b.use(_.default.urlencoded({extended:!1})),b.use(I.default.initialize()),b.use(I.default.session()),(0,M.default)(b),n.default=b},function(e,n){e.exports=require("helmet")},function(e,n){e.exports=require("morgan")},function(e,n){e.exports=require("compression")},function(e,n){e.exports=require("dotenv")},function(e,n){e.exports=require("body-parser")},function(e,n){e.exports=require("cookie-session")},function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var u=t(15),r=function(e){return e&&e.__esModule?e:{default:e}}(u);r.default.Promise=global.Promise;var o=process.env.MONGODB_HOST||"localhost",i=process.env.MONGODB_PORT||"27017",l=process.env.MONGODB_DB_NAME||"apis";r.default.connect("mongodb://"+o+":"+i+"/"+l),n.default=r.default},function(e,n){e.exports=require("mongoose")},function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var u=t(17),r=function(e){return e&&e.__esModule?e:{default:e}}(u),o={windowMs:9e5,max:100,delayMs:0};n.default=new r.default(o)},function(e,n){e.exports=require("express-rate-limit")},function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var u=t(19),r=function(e){return e&&e.__esModule?e:{default:e}}(u);n.default=function(e){e.use("/api",r.default),e.use(function(e,n,t){n.status(404),n.json({error:"Not found"})}),e.use(function(e,n,t,u){t.status(e.status||500),t.json({error:e.message})})}},function(e,n,t){"use strict";function u(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(n,"__esModule",{value:!0});var r=t(1),o=t(20),i=u(o),l=t(25),d=u(l),s=(0,r.Router)();s.post("/oauth/token",i.default.token),s.get("/user/me",d.default.info),s.get("/",function(e,n){n.end("express restful api")}),n.default=s},function(e,n,t){"use strict";function u(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(n,"__esModule",{value:!0});var r=t(21),o=u(r),i=t(0),l=u(i),d=t(22),s=u(d),f=t(23),a=u(f),c=t(2),p=u(c),v=t(3),_=u(v),g=t(24),I=u(g),y=t(4),x=u(y),h=o.default.createServer();h.serializeClient(function(e,n){return n(null,e.id)}),h.deserializeClient(function(e,n){x.default.findById(e,function(e,t){return e?n(e):n(null,t)})}),h.grant(o.default.grant.code(function(e,n,t,u,r){var o=a.default.getUid(16);I.default.save(o,e.id,n,t.id,function(e){return e?r(e):r(null,o)})})),h.grant(o.default.grant.token(function(e,n,t,u){var r=a.default.getUid(256);_.default.save(r,n.id,e.clientId,function(e){return e?u(e):u(null,r)})})),h.exchange(o.default.exchange.code(function(e,n,t,u){I.default.find(n,function(n,r){if(n)return u(n);if(e.id!==r.clientId)return u(null,!1);if(t!==r.redirectUri)return u(null,!1);var o=a.default.getUid(256);_.default.save(o,r.userId,r.clientId,function(e){return e?u(e):u(null,o)})})})),h.exchange(o.default.exchange.password(function(e,n,t,u,r){x.default.findByClientId(e.clientId,function(u,o){return u?r(u):o?o.clientSecret!==e.clientSecret?r(null,!1):void p.default.findByUsername(n,function(n,u){if(n)return r(n);if(!u)return r(null,!1);if(t!==u.password)return r(null,!1);var o=a.default.getUid(256);_.default.save(o,u.id,e.clientId,function(e){return e?r(e):r(null,o)})}):r(null,!1)})})),h.exchange(o.default.exchange.clientCredentials(function(e,n,t){x.default.findByClientId(e.clientId,function(n,u){if(n)return t(n);if(!u)return t(null,!1);if(u.clientSecret!==e.clientSecret)return t(null,!1);var r=a.default.getUid(256);_.default.save(r,null,e.clientId,function(e){return e?t(e):t(null,r)})})}));var O=[s.default.ensureLoggedIn(),h.authorization(function(e,n,t){x.default.findByClientId(e,function(e,u){return e?t(e):t(null,u,n)})},function(e,n,t){if(e.isTrusted)return t(null,!0);_.default.findByUserIdAndClientId(n.id,e.clientId,function(e,n){return n?t(null,!0):t(null,!1)})}),function(e,n){n.render("dialog",{transactionId:e.oauth2.transactionID,user:e.user,client:e.oauth2.client})}],m=[s.default.ensureLoggedIn(),h.decision()],M=[l.default.authenticate(["oauth2-client-password"],{session:!1}),h.token(),h.errorHandler()];n.default={authorization:O,decision:m,token:M}},function(e,n){e.exports=require("oauth2orize")},function(e,n){e.exports=require("connect-ensure-login")},function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var u=function(e){for(var n="",t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",u=t.length,o=0;o<e;++o)n+=t[r(0,u-1)];return n},r=function(e,n){return Math.floor(Math.random()*(n-e+1))+e};n.default={getUid:u,getRandomInt:r}},function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var u={},r=function(e,n){return u[e]?n(null,u[e]):n(new Error("Code Not Found"))},o=function(e,n,t,r,o){u[e]={clientId:n,redirectUri:t,userId:r},o()};n.default={find:r,save:o}},function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var u=t(0),r=function(e){return e&&e.__esModule?e:{default:e}}(u),o=[r.default.authenticate("bearer",{session:!1}),function(e,n){n.json({id:e.user.id,name:e.user.name,scope:e.authInfo.scope})}];n.default={info:o}},function(e,n,t){"use strict";function u(e){return e&&e.__esModule?e:{default:e}}var r=t(0),o=u(r),i=t(27),l=t(28),d=t(29),s=t(2),f=u(s),a=t(3),c=u(a),p=t(4),v=u(p);o.default.use(new i.Strategy(function(e,n,t){f.default.findByUsername(e,function(e,u){return e?t(e):u?u.password!==n?t(null,!1):t(null,u):t(null,!1)})})),o.default.serializeUser(function(e,n){return n(null,e.id)}),o.default.deserializeUser(function(e,n){f.default.findById(e,function(e,t){return n(e,t)})});var _=function(e,n,t){v.default.findByClientId(e,function(e,u){return e?t(e):u?u.clientSecret!==n?t(null,!1):t(null,u):t(null,!1)})};o.default.use(new l.Strategy(_)),o.default.use(new d.Strategy(function(e,n){c.default.find(e,function(e,t){return e?n(e):t?void(t.userId?f.default.findById(t.userId,function(e,t){return e?n(e):t?void n(null,t,{scope:"*"}):n(null,!1)}):v.default.findByClientId(t.clientId,function(e,t){return e?n(e):t?void n(null,t,{scope:"*"}):n(null,!1)})):n(null,!1)})}))},function(e,n){e.exports=require("passport-local")},function(e,n){e.exports=require("passport-oauth2-client-password")},function(e,n){e.exports=require("passport-http-bearer")}]);