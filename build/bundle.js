!function(e){function n(r){if(t[r])return t[r].exports;var u=t[r]={i:r,l:!1,exports:{}};return e[r].call(u.exports,u,u.exports,n),u.l=!0,u.exports}var t={};n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:r})},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)},n.p="",n(n.s=5)}([function(e,n){e.exports=require("passport")},function(e,n){e.exports=require("express")},function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=[{id:"1",username:"bob",password:"secret",name:"Bob Smith"},{id:"2",username:"joe",password:"password",name:"Joe Davis"}],u=function(e,n){for(var t=0,u=r.length;t<u;t++)if(r[t].id===e)return n(null,r[t]);return n(new Error("User Not Found"))},o=function(e,n){for(var t=0,u=r.length;t<u;t++)if(r[t].username===e)return n(null,r[t]);return n(new Error("User Not Found"))};n.default={findById:u,findByUsername:o}},function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r={},u=function(e,n){return r[e]?n(null,r[e]):n(new Error("Token Not Found"))},o=function(e,n,t){for(var u in r)if(r[u].userId===e&&r[u].clientId===n)return t(null,u);return t(new Error("Token Not Found"),null)},i=function(e,n,t,u){r[e]={userId:n,clientId:t},u()};n.default={find:u,findByUserIdAndClientId:o,save:i}},function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=[{id:"1",name:"Samplr",clientId:"abc123",clientSecret:"ssh-secret",isTrusted:!1},{id:"2",name:"Samplr2",clientId:"xyz123",clientSecret:"ssh-password",isTrusted:!0}],u=function(e,n){for(var t=0,u=r.length;t<u;t++)if(r[t].id===e)return n(null,r[t]);return n(new Error("Client Not Found"))},o=function(e,n){for(var t=0,u=r.length;t<u;t++)if(r[t].clientId===e)return n(null,r[t]);return n(new Error("Client Not Found"))};n.default={findById:u,findByClientId:o}},function(e,n,t){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(n,"__esModule",{value:!0});var u=t(6),o=r(u),i=t(7),l=r(i),d=o.default.createServer(l.default);d.listen(l.default.get("port"),l.default.get("host"),function(){console.log("Server is running on http://"+l.default.get("host")+":"+l.default.get("port")),console.log("Press CTRL-C to stop")}),n.default=d},function(e,n){e.exports=require("http")},function(e,n,t){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(n,"__esModule",{value:!0});var u=t(1),o=r(u),i=t(8),l=r(i),d=t(9),f=r(d),a=t(10),s=r(a),c=t(11),p=r(c),v=t(12),_=r(v),g=t(13),I=r(g),y=t(0),x=r(y),h=t(14),O=r(h);t(15);var m=t(17),M=r(m),S=t(19),b=r(S);t(26),p.default.config({path:"../.env"});var w=(0,o.default)();w.enable("trust proxy"),w.disable("x-powered-by"),w.set("trust proxy",1),w.set("host",process.env.HOST||"127.0.0.1"),w.set("port",process.env.PORT||"3000"),w.use((0,l.default)()),w.use(M.default),w.use((0,s.default)()),w.use((0,f.default)("common")),w.use((0,O.default)({name:"session",keys:[process.env.COOKIE_SESSION_SECRET_KEY1,process.env.COOKIE_SESSION_SECRET_KEY2],maxAge:process.env.COOKIE_SESSION_MAX_AGE})),w.use(_.default.json({extended:!1})),w.use(_.default.urlencoded({extended:!1})),w.use((0,I.default)()),w.use(x.default.initialize()),w.use(x.default.session()),(0,b.default)(w),n.default=w},function(e,n){e.exports=require("helmet")},function(e,n){e.exports=require("morgan")},function(e,n){e.exports=require("compression")},function(e,n){e.exports=require("dotenv")},function(e,n){e.exports=require("body-parser")},function(e,n){e.exports=require("errorhandler")},function(e,n){e.exports=require("cookie-session")},function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=t(16),u=function(e){return e&&e.__esModule?e:{default:e}}(r);u.default.Promise=global.Promise;var o=process.env.MONGODB_HOST||"localhost",i=process.env.MONGODB_PORT||"27017",l=process.env.MONGODB_DB_NAME||"apis";u.default.connect("mongodb://"+o+":"+i+"/"+l),n.default=u.default},function(e,n){e.exports=require("mongoose")},function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=t(18),u=function(e){return e&&e.__esModule?e:{default:e}}(r),o={windowMs:9e5,max:100,delayMs:0};n.default=new u.default(o)},function(e,n){e.exports=require("express-rate-limit")},function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=t(20),u=function(e){return e&&e.__esModule?e:{default:e}}(r);n.default=function(e){e.use("/api",u.default)}},function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=t(1),u=t(21),o=function(e){return e&&e.__esModule?e:{default:e}}(u),i=(0,r.Router)();i.post("/oauth/token",o.default.token),i.get("/",function(e,n){n.end("Api")}),n.default=i},function(e,n,t){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(n,"__esModule",{value:!0});var u=t(22),o=r(u),i=t(0),l=r(i),d=t(23),f=r(d),a=t(24),s=r(a),c=t(2),p=r(c),v=t(3),_=r(v),g=t(25),I=r(g),y=t(4),x=r(y),h=o.default.createServer();h.serializeClient(function(e,n){return n(null,e.id)}),h.deserializeClient(function(e,n){x.default.findById(e,function(e,t){return e?n(e):n(null,t)})}),h.grant(o.default.grant.code(function(e,n,t,r,u){var o=s.default.getUid(16);I.default.save(o,e.id,n,t.id,function(e){return e?u(e):u(null,o)})})),h.grant(o.default.grant.token(function(e,n,t,r){var u=s.default.getUid(256);_.default.save(u,n.id,e.clientId,function(e){return e?r(e):r(null,u)})})),h.exchange(o.default.exchange.code(function(e,n,t,r){I.default.find(n,function(n,u){if(n)return r(n);if(e.id!==u.clientId)return r(null,!1);if(t!==u.redirectUri)return r(null,!1);var o=s.default.getUid(256);_.default.save(o,u.userId,u.clientId,function(e){return e?r(e):r(null,o)})})})),h.exchange(o.default.exchange.password(function(e,n,t,r,u){x.default.findByClientId(e.clientId,function(r,o){return r?u(r):o?o.clientSecret!==e.clientSecret?u(null,!1):void p.default.findByUsername(n,function(n,r){if(n)return u(n);if(!r)return u(null,!1);if(t!==r.password)return u(null,!1);var o=s.default.getUid(256);_.default.save(o,r.id,e.clientId,function(e){return e?u(e):u(null,o)})}):u(null,!1)})})),h.exchange(o.default.exchange.clientCredentials(function(e,n,t){x.default.findByClientId(e.clientId,function(n,r){if(n)return t(n);if(!r)return t(null,!1);if(r.clientSecret!==e.clientSecret)return t(null,!1);var u=s.default.getUid(256);_.default.save(u,null,e.clientId,function(e){return e?t(e):t(null,u)})})}));var O=[f.default.ensureLoggedIn(),h.authorization(function(e,n,t){x.default.findByClientId(e,function(e,r){return e?t(e):t(null,r,n)})},function(e,n,t){if(e.isTrusted)return t(null,!0);_.default.findByUserIdAndClientId(n.id,e.clientId,function(e,n){return n?t(null,!0):t(null,!1)})}),function(e,n){n.render("dialog",{transactionId:e.oauth2.transactionID,user:e.user,client:e.oauth2.client})}],m=[f.default.ensureLoggedIn(),h.decision()],M=[l.default.authenticate(["oauth2-client-password"],{session:!1}),h.token(),h.errorHandler()];n.default={authorization:O,decision:m,token:M}},function(e,n){e.exports=require("oauth2orize")},function(e,n){e.exports=require("connect-ensure-login")},function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(e){for(var n="",t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",r=t.length,o=0;o<e;++o)n+=t[u(0,r-1)];return n},u=function(e,n){return Math.floor(Math.random()*(n-e+1))+e};n.default={getUid:r,getRandomInt:u}},function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r={},u=function(e,n){return r[e]?n(null,r[e]):n(new Error("Code Not Found"))},o=function(e,n,t,u,o){r[e]={clientId:n,redirectUri:t,userId:u},o()};n.default={find:u,save:o}},function(e,n,t){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}var u=t(0),o=r(u),i=t(27),l=t(28),d=t(29),f=t(2),a=r(f),s=t(3),c=r(s),p=t(4),v=r(p);o.default.use(new i.Strategy(function(e,n,t){a.default.findByUsername(e,function(e,r){return e?t(e):r?r.password!==n?t(null,!1):t(null,r):t(null,!1)})})),o.default.serializeUser(function(e,n){return n(null,e.id)}),o.default.deserializeUser(function(e,n){a.default.findById(e,function(e,t){return n(e,t)})});var _=function(e,n,t){v.default.findByClientId(e,function(e,r){return e?t(e):r?r.clientSecret!==n?t(null,!1):t(null,r):t(null,!1)})};o.default.use(new l.Strategy(_)),o.default.use(new d.Strategy(function(e,n){c.default.find(e,function(e,t){return e?n(e):t?void(t.userId?a.default.findById(t.userId,function(e,t){return e?n(e):t?void n(null,t,{scope:"*"}):n(null,!1)}):v.default.findByClientId(t.clientId,function(e,t){return e?n(e):t?void n(null,t,{scope:"*"}):n(null,!1)})):n(null,!1)})}))},function(e,n){e.exports=require("passport-local")},function(e,n){e.exports=require("passport-oauth2-client-password")},function(e,n){e.exports=require("passport-http-bearer")}]);